<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Azoul ¬∑ Workwatch</title>
  <style>
    :root{
      --bg:#0e1a2b;           /* deep blue background */
      --card:#ffffff;         /* white cards */
      --text:#0d1b2a;         /* dark text */
      --muted:#718096;
      --brand:#2363ff;        /* Azoul blue */
      --brand-600:#1b4ed9;
      --brand-100:#e7efff;
      --ring: rgba(35,99,255,.35);
      --success:#11a36a;
      --danger:#e53e3e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      background:linear-gradient(180deg,#0a1530, var(--bg) 30%, #0a1530 100%);
      color:#f1f5f9;
    }

    /* Page shell */
    .wrap{
      min-height:100dvh;
      display:flex;
      flex-direction:column;
    }
    header{
      display:flex;
      align-items:center;
      gap:.6rem;
      padding:16px 20px;
      border-bottom:1px solid rgba(255,255,255,.06);
      backdrop-filter:saturate(140%) blur(6px);
      position:sticky; top:0; z-index:5;
    }
    header .dot{
      width:10px;height:10px;border-radius:50%;
      background:conic-gradient(from 0deg at 50% 50%, #4da3ff, #7fb5ff, #c6dcff, #4da3ff);
      box-shadow:0 0 16px rgba(77,163,255,.6);
    }
    header .brand{
      font-weight:700; letter-spacing:.2px;
    }
    header .brand small{
      opacity:.75; font-weight:600; margin-left:.4rem;
    }

    main{flex:1; display:grid; place-items:center; padding:28px}

    /* Panels */
    .panel{
      width:min(880px, 94vw);
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:18px;
      box-shadow: 0 10px 35px rgba(0,0,0,.35), 0 0 0 8px rgba(255,255,255,.02) inset;
      backdrop-filter: blur(6px);
    }
    .panel-inner{
      background:#0f1d33;
      border-radius:12px;
      padding: clamp(18px, 2.5vw, 28px);
      border:1px solid rgba(255,255,255,.06);
    }

    /* Step headers */
    .h{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      margin-bottom:18px;
    }
    .h .t{
      font-size: clamp(18px, 2.2vw, 22px);
      font-weight: 700;
    }
    .h .sub{
      color:#c7d2fe; opacity:.8; font-size:14px;
    }

    /* Form */
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:720px){ .grid{ grid-template-columns:1fr } }
    label{
      display:block; font-size:13px; color:#dbeafe; margin:4px 0 6px;
    }
    .input{
      width:100%;
      background: #0b162a;
      border:1.5px solid rgba(255,255,255,.12);
      color:#e6edf7;
      border-radius:10px;
      padding:12px 12px;
      outline:none;
      transition:.2s border,.2s box-shadow;
    }
    .input:focus{
      border-color: var(--brand);
      box-shadow: 0 0 0 4px var(--ring);
    }
    .hint{ color:#9bb2d1; font-size:12px; margin-top:6px }

    .actions{
      display:flex; gap:10px; align-items:center; justify-content:flex-end;
      margin-top:14px;
    }
    .btn{
      appearance:none; border:none; cursor:pointer;
      background:var(--brand); color:white; font-weight:700;
      padding:12px 16px; border-radius:10px;
      transition:.2s transform,.2s background,.2s box-shadow;
      box-shadow: 0 10px 18px rgba(35,99,255,.28);
    }
    .btn:hover{ background:var(--brand-600) }
    .btn:active{ transform: translateY(1px) }
    .btn.secondary{
      background:transparent; color:#e2e8f0; border:1px solid rgba(255,255,255,.18);
      box-shadow:none;
    }

    /* Cards step */
    .cards{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width:920px){ .cards{ grid-template-columns: repeat(2, 1fr) } }
    @media (max-width:640px){ .cards{ grid-template-columns: 1fr } }

    .card{
      background:var(--card);
      color:var(--text);
      border:1px solid #e6eaf2;
      border-radius:14px;
      padding:14px;
      display:flex; gap:12px; align-items:flex-start;
      cursor:pointer;
      transition: .18s transform, .18s box-shadow, .18s border-color;
      box-shadow: 0 6px 16px rgba(8,15,30,.1);
      user-select:none;
    }
    .card:hover{ transform: translateY(-1px) }
    .card.selected{
      border-color: var(--brand);
      box-shadow: 0 0 0 3px var(--brand-100);
    }
    .ic{
      width:36px; height:36px; flex:0 0 36px; border-radius:10px;
      display:grid; place-items:center;
      background:#eef3ff; color:#2746cf; font-weight:900;
    }
    .ctitle{ font-weight:800; margin-bottom:4px }
    .cdesc{ color:#344; opacity:.9; font-size:13.5px }

    .other{
      margin-top:10px;
      background:white; border:1px dashed #cbd5e1; border-radius:12px; padding:12px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      background:#eef2ff; color:#29304a;
      border:1px solid #ccd6ff; padding:8px 12px; border-radius:999px;
      font-weight:700; font-size:13px;
    }
    .savebar{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-top:16px;
    }
    .small{ font-size:12px; color:#7b8aa6 }

    /* Toast */
    .toast{
      position: fixed; bottom:18px; right:18px;
      background:#0b162a; color:#e7f1ff; border:1px solid rgba(255,255,255,.12);
      border-radius:12px; padding:12px 14px; box-shadow:0 10px 28px rgba(0,0,0,.35);
      display:none; z-index:10;
    }

    /* Hideable sections */
    .hidden{ display:none !important }
  </style>
</head>
<body>
  <div class="wrap">

    <header>
      <span class="dot" aria-hidden="true"></span>
      <div class="brand">Azoul <small>Workwatch</small></div>
    </header>

    <main>
      <section class="panel" id="step1-panel">
        <div class="panel-inner">
          <div class="h">
            <div>
              <div class="t">Sign in to begin</div>
              <div class="sub">Enter your email and your team/group (or type <b>N/A</b>).</div>
            </div>
          </div>

          <form id="introForm" novalidate>
            <div class="grid">
              <div>
                <label for="email">Email</label>
                <input class="input" id="email" name="email" type="email" placeholder="you@example.com" required />
                <div class="hint">We only use this to save your selections.</div>
              </div>
              <div>
                <label for="team">Team / Group</label>
                <input class="input" id="team" name="team" type="text" placeholder="Marketing, Support, Engineering‚Ä¶ or N/A" />
                <div class="hint">If you don‚Äôt have one, write <b>N/A</b>.</div>
              </div>
            </div>

            <div class="actions">
              <button type="submit" class="btn" id="continueBtn">Continue</button>
            </div>
          </form>
        </div>
      </section>

      <section class="panel hidden" id="step2-panel" aria-hidden="true">
        <div class="panel-inner">
          <div class="h">
            <div>
              <div class="t">What‚Äôs affecting you?</div>
              <div class="sub">Choose all that apply. You can add your own under ‚ÄúOther‚Äù.</div>
            </div>
            <div class="pill" id="whoPill" title="Signed in user">üë§ <span id="whoText">‚Äî</span></div>
          </div>

          <div class="cards" id="cards"></div>

          <div class="other">
            <label for="otherText"><b>Other</b> (optional)</label>
            <input class="input" id="otherText" type="text" placeholder="Type another issue‚Ä¶" />
          </div>

          <div class="savebar">
            <div class="small" id="selCount">0 selected</div>
            <div class="actions">
              <button class="btn secondary" id="backBtn">Back</button>
              <button class="btn" id="saveBtn">Save</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <div class="toast" id="toast">Saved ‚úî</div>
  </div>

  <script>
    // ---------- Utilities ----------
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const toast = (msg) => {
      const t = $('#toast'); t.textContent = msg; t.style.display = 'block';
      setTimeout(()=> t.style.display='none', 1600);
    };

    // ---------- Step 1 (Sign-in) ----------
    const form = $('#introForm');
    const step1 = $('#step1-panel');
    const step2 = $('#step2-panel');
    const whoText = $('#whoText');

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const email = $('#email').value.trim();
      const team = $('#team').value.trim() || 'N/A';

      // simple email check (not strict)
      const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if(!ok){
        $('#email').focus();
        toast('Please enter a valid email.');
        return;
      }
      // Persist identity (local only; replace with backend as needed)
      localStorage.setItem('azoul_user', JSON.stringify({email, team, at: Date.now()}));

      whoText.textContent = `${email} ¬∑ ${team}`;
      step1.classList.add('hidden');
      step2.classList.remove('hidden');
      step2.setAttribute('aria-hidden','false');
    });

    $('#backBtn').addEventListener('click', ()=>{
      step2.classList.add('hidden');
      step1.classList.remove('hidden');
      step2.setAttribute('aria-hidden','true');
    });

    // ---------- Cards ----------
    const issues = [
      { id:'low-pay',     icon:'üí∏', title:'Low Pay',       desc:'Compensation feels below market or role expectations.' },
      { id:'harassment',  icon:'üö´', title:'Harassment',    desc:'Unwelcome behavior, bullying, or discrimination.' },
      { id:'burnout',     icon:'‚ö†Ô∏è', title:'Burnout',       desc:'Exhaustion, overload, or chronic stress.' },
      { id:'overtime',    icon:'‚è±Ô∏è', title:'Overtime',      desc:'Regular unpaid/expected overtime or on-call.' },
      { id:'safety',      icon:'üõ°Ô∏è', title:'Safety',        desc:'Physical/psychological safety concerns at work.' },
      { id:'management',  icon:'üìâ', title:'Management',     desc:'Poor leadership, unclear direction, favoritism.' },
      { id:'career',      icon:'ü™ú', title:'Career Growth',  desc:'Limited advancement or skill development.' },
      { id:'benefits',    icon:'üéÅ', title:'Benefits',       desc:'Health, PTO, or other benefits lacking.' },
      { id:'culture',     icon:'üè¢', title:'Culture',        desc:'Toxic dynamics, exclusion, or low trust.' }
    ];

    const cardsWrap = $('#cards');
    const selections = new Set();
    const renderCards = () => {
      cardsWrap.innerHTML = '';
      issues.forEach(x=>{
        const div = document.createElement('button');
        div.type = 'button';
        div.className = 'card';
        div.setAttribute('data-id', x.id);
        div.innerHTML = `
          <div class="ic" aria-hidden="true">${x.icon}</div>
          <div>
            <div class="ctitle">${x.title}</div>
            <div class="cdesc">${x.desc}</div>
          </div>
        `;
        div.addEventListener('click', ()=>{
          const id = x.id;
          if(selections.has(id)){ selections.delete(id); div.classList.remove('selected'); }
          else { selections.add(id); div.classList.add('selected'); }
          updateCount();
        });
        cardsWrap.appendChild(div);
      });
    };
    renderCards();

    const updateCount = ()=> $('#selCount').textContent = `${selections.size} selected`;

    // ---------- Save ----------
    $('#saveBtn').addEventListener('click', ()=>{
      const who = JSON.parse(localStorage.getItem('azoul_user')||'{}');
      const other = $('#otherText').value.trim();
      const payload = {
        user: who,
        selections: Array.from(selections),
        other: other || null,
        savedAt: new Date().toISOString()
      };

      // Local-only persistence (replace with fetch(...) to your backend)
      const all = JSON.parse(localStorage.getItem('azoul_reports')||'[]');
      all.push(payload);
      localStorage.setItem('azoul_reports', JSON.stringify(all));

      toast('Saved ‚úî');
      // Optional: clear selection
      selections.clear(); $$('.card').forEach(c=>c.classList.remove('selected'));
      $('#otherText').value = '';
      updateCount();
    });

    // ---------- Safety: Hide accidental "code at top" ----------
    // If some server accidentally prints raw code into a #debug or .dump element, remove it.
    // This prevents that "codes at the top" problem without touching your backend.
    window.addEventListener('DOMContentLoaded', ()=>{
      const junkSelectors = ['#debug','#dump','.raw','.codesat','.code-dump','pre.dump','pre.raw'];
      junkSelectors.forEach(sel => $$(sel).forEach(n=> n.remove()));
      updateCount();

      // If user already signed before, auto-fill
      try{
        const who = JSON.parse(localStorage.getItem('azoul_user')||'{}');
        if(who.email){
          $('#email').value = who.email;
          $('#team').value = who.team || '';
          whoText.textContent = `${who.email} ¬∑ ${who.team||'N/A'}`;
        }
      }catch{}
    });
  </script>
</body>
</html>
